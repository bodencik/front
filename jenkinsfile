pipeline {
  agent any
  tools {nodejs "node"}
  stages {

  stage('PM2 Install') {
        steps {
	echo 'Installing PM2 to run application as daemon...'
        sh "npm install pm2 -g"
	}
       }
   stage('build') {
      steps {
        sh 'npm -v'
        sh 'npm install'
      }
    }
    stage('Run Application') {
       steps {
        echo 'Stopping old process to run new process...'
 	sh 'who'
	sshagent(['0ecf3592-ac58-4c91-812c-7d013d3f0708']) {
  	
	sh 'ssh ec2-user@10.0.1.32; npm -v'	 
 	
}
	         
	}
     }	
	
  }
}  
