pipeline {
  agent any
  tools {nodejs "node"}
  stages {

  stage('PM2 Install') {
        steps {
	echo 'Installing PM2 to run application as daemon...'
        sh "npm install pm2 -g"
	}
       }
   stage('build') {
      steps {
        sh 'npm -v'
        sh 'npm install'
      }
    }
    stage('Run Application') {
       steps {
        echo 'Stopping old process to run new process...'
        sshagent (credentials: ['ec2-user (keys of front inst)']) {
		sh 'ssh-add -l hmod +rwx deploy.sh;ls -l deploy.sh; ./deploy.sh' 	 
    	}

        

	sh 'exit'          
	}
     }	
	
  }
}  
