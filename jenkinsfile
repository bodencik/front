pipeline {
  agent any
  tools {nodejs "node"}
  stages {

  stage('PM2 Install') {
        steps {
	echo 'Installing PM2 to run application as daemon...'
        sh "npm install pm2 -g"
	}
       }
   stage('build') {
      steps {
        sh 'npm -v'
        sh 'npm install'
      }
    }
    stage('Run Application') {
       steps {
        echo 'Stopping old process to run new process...'
 	sh 'who'
	sh 'ls /home/ec2-user'
	sh 'ssh ec2-user@10.0.1.32 pwd'	 
 	sh 'exit'          
	}
     }	
	
  }
}  
